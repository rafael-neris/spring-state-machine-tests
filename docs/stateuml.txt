@startuml
state join_state <<join>>
state fork_state <<fork>>
[*] --> NEW : PRE_AUTHORIZE
NEW --> PRE_AUTH : PRE_AUTH_APPROVED
NEW --> PRE_AUTH_ERROR : PRE_AUTH_DECLINED
PRE_AUTH_ERROR --> [*]
PRE_AUTH --> AUTHORIZED : AUTHORIZED
AUTHORIZED --> [*]
PRE_AUTH --> AUTHORIZE_ERROR : AUTH_DECLINED
AUTHORIZE_ERROR --> [*]
AUTHORIZE_ERROR --> fork_state : REFUND_FLOW
fork_state --> Refund : REFUND
fork_state --> Notify : NOTIFY
Refund --> join_state : REFUNDED
Notify --> join_state : NOTIFIED

join_state --> [*]

state Refund {
  [*] --> REFUND
  REFUND --> RESERVED : RESERVE
  RESERVED --> CONFIRMED : CONFIRM
  CONFIRMED --> REFUND_COMPLETED : REFUND_COMPLETED
  REFUND_COMPLETED --> [*]
}

state Notify {
  [*] --> WAITING_NOTIFY
  WAITING_NOTIFY --> Notified
  Notified --> [*]
}
@enduml